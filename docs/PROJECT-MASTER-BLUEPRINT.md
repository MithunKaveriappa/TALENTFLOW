# PROJECT MASTER BLUEPRINT (Official Project Documentation)

**Last Updated:** February 15, 2026 (Revision: Elite Messaging & Notification Hub Implemented)  
**Status:** Live Implementation / Active Development

This is the primary source of truth for the TalentFlow ecosystem. It contains comprehensive technical specifications, business logic, and architectural patterns.

---

## 0. Unified UI Architecture (2026 "Matrix" Design)

To ensure a seamless, high-performance experience, TalentFlow uses a unified layout system across all candidate and recruiter dashboard features.

### 0.1 Shared Sidebar System

- **Recruiter Sidebar**: Centralized navigation suite ([RecruiterSidebar.tsx](apps/web/src/components/RecruiterSidebar.tsx)) with blue-themed "Matrix" accents. Dynamically handles **Feature Locking** by checking `profileScore` to disable restricted routes for "Do It Later" recruiters.
- **Candidate Sidebar**: Dedicated indigo-themed navigation ([CandidateSidebar.tsx](apps/web/src/components/CandidateSidebar.tsx)) for talent-facing tools.
- **Verification Hub**: Integrated compact status center in the sidebar that displays the user's current `assessment_status` (In-progress, Not Started, or Completed) and provides direct "Complete Now" action shortcuts.

### 0.2 Standardized Navigation Suite

| Functional Area    | Recruiter Labels   | Candidate Labels |
| :----------------- | :----------------- | :--------------- |
| **Home**           | Dashboard          | Dashboard        |
| **Pipeline (A)**   | Applied Pipeline   | Applications     |
| **Matching**       | Recommended Talent | -                |
| **Talent Search**  | Candidate Pool     | -                |
| **Primary Action** | Post a Job         | Job Board        |
| **Management**     | My Jobs            | -                |
| **Social**         | Feed               | Feed             |
| **Identity**       | Profile            | Profile          |
| **System**         | Settings           | Settings         |

### 0.3 Navigation UX

- **Global Logout**: Standardized "Logout" action in the sidebar and top-right of every dashboard header for immediate accessibility.
- **Header Sync**: Page headers are dynamically synchronized with sidebar labels (e.g., "Ecosystem Feed" evolved to a cleaner "Feed").
- **Fixed Layout**: 64-unit persistent sidebar with responsive `ml-64` main content areas for consistent flow.

---

The TalentFlow assessment is a hybrid evaluation engine that combines **Semantic AI matching** (Generative) with **Validated Psychometric seeding**. It aims to move beyond simple keyword matching to verify actual expertise, logic, and character traits.

---

## 2. Seniority-Based Budgets & Weighting

The assessment length and complexity dynamically scale based on the candidate's reported experience level.

### 2.1 The Budget & Weighting Table

| Experience Band | Total Questions | Resume AI | Skill Case Study | Behavioral | Psychometric |
| :-------------- | :-------------: | :-------: | :--------------: | :--------: | :----------: |
| **Fresher**     |        8        |    20%    |       10%        |    35%     |     35%      |
| **Mid-Level**   |       10        |    20%    |       20%        |    30%     |     30%      |
| **Senior**      |       13        |    20%    |       30%        |    25%     |     25%      |
| **Leadership**  |       16        |    25%    |       35%        |    20%     |     20%      |

### 2.2 Category Definitions

- **Resume AI Deep Dive**: Dynamically generated by Gemini 1.5 Flash based on the candidate's parsed CV (Career gaps, role consistency, specific achievements).
- **Skill Case Study**: High-pressure technical scenarios based on the candidate's self-reported top skills. Requires justifying a specific technical decision.
- **Behavioral (Seeded)**: Questions pulled from a bank of 800+ validated prompts targeting traits like _Resilience_, _Communication_, and _Adaptability_.
- **Psychometric (Seeded)**: Targeted at character drivers such as _Growth Potential_, _Emotional Stability_, and _Ambition_.

---

## 3. The Scoring Mechanism (0-100 Profile Score)

### 3.1 The 0-6 Dimensional Grading

Every response is evaluated by a multi-dimensional AI Grader on a scale of 0 to 6:

- **Relevance**: Alignment with the prompt.
- **Specificity**: Use of concrete examples/data.
- **Clarity**: Communication effectiveness.
- **Ownership**: Accountability and initiative.

### 3.2 Candidate Profile Score Calculation

The final Profile Score (0-100) is a weighted average of these component scores, normalized across the total response set.

### 3.3 The Recruiter "Trust Score" Matrix

To protect candidate raw data, recruiters see a masked **Trust Score** calculated as:
$$Trust Score = (Psychometric Score \times 0.6) + (Behavioral Score \times 0.4)$$
Raw psychometric and behavioral metrics are deleted from the API payload before delivery to the frontend.

---

## 4. Candidate Workflows & Gating

### 4.1 Onboarding Flow & Gating

The candidate onboarding is a 6-step conversational flow designed to build trust and gather high-quality data.

1.  **Experience Selection**: Defines the seniority band (Fresher to Leadership).
2.  **Resume Intelligence**: AI parsing or interactive manual builder for a professional PDF.
3.  **Skill Enrichment**: Confirmation of core technical and soft skills.
4.  **Identity Verification**: Upload of Aadhaar/Passport for KYC.
5.  **Terms & Conditions**: Final legal consent step.
6.  **Onboarding Completion**: Unlocks the dashboard.

- **Strict Dashboard Gating**: The primary candidate dashboard ([page.tsx](apps/web/src/app/dashboard/candidate/page.tsx)) operates on a "3-Signal Lock" system. Access to Job Boards and Career Tools is denied until three criteria are met:
  1.  **Assessment**: `assessment_status` is `completed`.
  2.  **Identity**: Aadhaar/KYC is verified.
  3.  **Consent**: Platform terms are accepted.
- **Visual Progress**: Incomplete signals are displayed as "LOCKED" cards with direct action buttons to ensure a 100% completion rate before any applications.

### 4.2 Retake Functionality

- Accessible via **Profile Settings**.
- Action: Resets the assessment session and responses for a fresh evaluation.
- **Best Score Logic**: If the candidate scores lower on a retake than their previous attempt, the system **keeps the higher old score**.
- **Performance Reset**: Unlocks the `experience_band` for editing, allowing candidates who have upskilled to re-level their profile.

### 4.3 Profile Integrity & Data Locking

To maintain a high-trust environment for recruiters, candidate profiles are **physically locked** once an assessment is completed.

- **Experience Band Lock**: Candidates cannot change their seniority level (e.g., from "Mid-Level" to "Senior") after completing an assessment tailored to that band. This prevents "hunting" for easier questions.
- **Skill Freeze**: Core skills verified during the assessment are marked with a `LOCKED` badge and cannot be removed without a **Performance Reset** (Retake).
- **Modification Rule**: Non-grading fields (Phone, Location, Bio) remain editable.

---

## 5. Security & Anti-Cheat (Zero-Tolerance)

### 5.1 Tab Switching (Anti-Cheat)

- **Strike 1**: Warning prompt.
- **Strike 2**: Immediate session termination.
- **Penalty**: User is added to `blocked_users` and permanently banned from the platform.

### 5.2 Time-Boxing

- **Standard Questions**: 60 seconds to respond.
- **Case Studies**: 90-120 seconds (depending on complexity).
- **Failure**: A timeout results in a 0.0 score for that specific question.

### 5.3 Application Guardrails (Anti-Spam)

To prevent "Easy Apply" spam and ensure candidates only apply to high-relevance roles:

- **Daily Application Limit**: A strict hard-limit of **5 applications per day**.
- **Enforcement**: This is enforced at the database level ([candidate_service.py](apps/api/src/services/candidate_service.py)) via a 24-hour ISO date window check.
- **UX**: The Job Board displays a "Daily Signal Count (X/5)" and disables "Apply" buttons once the quota is exhausted.

---

## 6. Recruiter Workspace & Pipeline Architecture

The recruiter workspace is a high-stakes management interface designed to prioritize quality and process integrity.

### 6.1 The Dual Pipeline Strategy

1.  **Applied Pipeline (Category A)**:
    - **Purpose**: Manage reactive applicants who proactive applied to a job.
    - **Match Detection**: Automatically flags "Skill Matches" for candidates possessing ≥2 key skills or ≥40% JD alignment.
    - **Bulk Actions**: Supports multi-selection for bulk shortlisting or rejection to optimize workflow.

2.  **Recommended Talent (Category B)**:
    - **Purpose**: Proactive sourcing of the "Elite 1%."
    - **Matching Logic**: 70% Psychometric / 30% Behavioral weighting.
    - **Filter Logic**: Focuses on cultural and character alignment over mere keyword matching.

3.  **Global Candidate Pool**:
    - **Purpose**: A discovery hub for all verified talent on the platform.
    - **Search Criteria**: Filter by Role, Experience, and Skill keywords.
    - **Invite System**: Recruiters can send "Elite Invites" with personalized messages and specific Job Description context.

### 6.2 Interview Scheduling & Virtual Rooms

- **Jitsi Integration**: Automated generation of secure Jitsi Meet URIs (`TalentFlow-<app_id>`) upon scheduling. Links are persistent and synchronized between candidate and recruiter dashboards.
- **UTC Standardization**: All timestamps are handled in UTC and converted to local time via the frontend (`date-fns`) for global team coordination.
- **Status Gating**: Interview UI is only accessible once the application moves to the `interview_scheduled` status.

### 6.3 Recruiter Dashboard "Hard Locks"

To maintain platform integrity and ensure high-trust matching, recruiters who skip the initial DNA assessment encounter functional gates:

- **Prop Gating**: The [layout.tsx](apps/web/src/app/dashboard/recruiter/layout.tsx) fetches the company profile score and drills it down to the sidebar and page components.
- **LockedView UI**: Features like **Career GPS** and **Candidate Intelligence** are wrapped in a `LockedView` component that provides a call-to-action to complete the assessment.
- **Functional Disable**: Sidebar links for locked features are visually muted and pointer-events are disabled until `profile_score > 0`.

### 6.4 The Cumulative Hiring Funnel

The primary analytics hub for recruiters utilizes a cumulative logic model:

- **Funnel Progression**: Calculates the total volume of talent passing through each stage (`applied` + `shortlisted` + `interviewed` + `hired`).
- **Optimal Health Signal**: Based on conversion ratios between stages (e.g., Shortlist-to-Interview ratio).
- **Visual Feedback**: A multi-stage progress component on the dashboard provides immediate visibility into pipeline efficiency.

---

## 7. High-Trust Lifecycle Guardrails

To prevent process manipulation and ensure a high-quality experience for candidates, the platform enforces strict lifecycle rules.

### 7.1 Trigger-Level Transition Enforcement

A PostgreSQL trigger ([lifecycle_guardrails.sql](infra/scripts/lifecycle_guardrails.sql)) prevents recruiters from "skipping" critical stages.

- **The Gold Path**: `applied` → `shortlisted` → `interview_scheduled` → `offered`.
- **Validation**: Any attempt to move from `shortlisted` to `offered` without an intervening `interview_scheduled` status will result in a Database Level Error.

### 7.2 The Audit Trail

- **`job_application_status_history`**: A persistent log of every status change.
- **Verification UI**: Recruiters and candidates can view the "Application History" modal, showing exact timestamps and actors (Who moved the status and when).

### 7.3 Contextual Chat Locking

- **Bandwidth Protection**: Chat threads are locked for "Applied" candidates.
- **Auto-Unlock**: Messaging permissions are granted automatically when a candidate is **Shortlisted** or **Invited**, ensuring recruiters only spend time on high-potential talent.

---

## 8. Candidate Career Workspace (The Applications State Machine)

The dashboard provides a real-time, high-transparency view of the candidate's journey.

### 6.1 The Application Timeline

Every application follows a strict state-transition path to ensure clarity. The UI ([applications/page.tsx](apps/web/src/app/dashboard/candidate/applications/page.tsx)) maps these database states to a visual lifecycle:

- `recommended` → `applied` → `invited` → `shortlisted` → `interview_scheduled` → `offered` / `rejected`.

### 6.2 Closure & Feedback

- **Transparent Rejection**: When a recruiter rejects an application, the candidate receives a clear "Closed" status along with structured feedback (if provided by the recruiter).
- **History Tracking**: All past applications are archived with their final outcome, building a "Career Signal Log" for the user.

The scoring system is designed to be "loss-proof," ensuring a candidate's hard-earned high score is never accidentally lowered.

### 6.1 Database Schema

- **`assessment_sessions`**: Tracks live state (current question, experience band, total budget).
- **`assessment_responses`**: Stores individual answers and their 0.0–6.0 AI-assigned scores.
- **`profile_scores`**: The persistent table for normalized 0-100 categorical scores and the current high score.
- **`candidate_profiles`**: Global user status (`assessment_status`) and the definitive `final_profile_score` shown to recruiters.

### 6.2 Retake Architecture (Phase-by-Phase)

1.  **Phase A: Clean Slate**: On retake initiation, `assessment_sessions` and `assessment_responses` are wiped. However, `profile_scores` is preserved as a comparison backup.
2.  **Phase B: Evaluation**: Candidate completes the fresh set of questions (8–16 based on band).
3.  **Phase C: Best Score Comparison**:
    - Upon completion, the new calculated score is compared against the `existing_high_score` in `profile_scores`.
    - **Logic**: `final_score = max(new_score, existing_score)`.
    - Result: The user is never penalized for a poor retake; the dashboard only ever displays their best performance.

---

## 7. Recruiter Assessment System (Company DNA)

### 7.1 The Onboarding Intelligence (Auto-Bio)

To provide a seamless experience, TalentFlow implements **Company Intelligence Scraping** during the onboarding phase:

- **Trigger**: When the recruiter provides the company website URL.
- **Action**: The backend scrapes the homepage, sanitizes the content, and uses **Gemini 1.5 Flash** to extract a professional 2-3 sentence bio.
- **UX**: The recruiter reviews the generated bio and can **Keep**, **Edit**, or **Replace** it before proceeding. This ensures data accuracy while minimizing manual entry.

### 7.2 The 5 Pillars of Recruitment DNA

Each assessment consists of 5 questions, randomly selected from a bank of **125 questions** (25 per category):

1.  **Strategic Intent & Universal DNA**: Understanding the company's "Soul" and long-term vision.
2.  **Ideal Talent Archetype (ICP)**: Definitions of high performance beyond technical skills.
3.  **Ethical Integrity & Bias Neutralization**: Commitment to fairness and objective hiring.
4.  **Value Proposition & Talent Magnetism**: Ability to articulate non-monetary value.
5.  **Ownership & Outcome Accountability**: Personal responsibility for a hire's success.

### 7.2 The Objective Auditor (Gemini 1.5 Flash)

---

## 8. Controlled Chat (The Elite Hub)

### 8.1 Messaging Manifesto

TalentFlow messaging is not a social network; it is a high-stakes professional channel.

- **Recruiter Initiation**: Candidates cannot "Cold Message" recruiters. A thread is only created when a recruiter sends an **Elite Invite**.
- **The Elite Invite**: To open a chat, the recruiter MUST provide a personalized initiation message. Generic "Hi" messages are discouraged by the UI.
- **Single Persistence**: Only one thread exists per pair. If a recruiter closes a chat and re-opens it later, the history is preserved for audit.

### 8.2 Real-time Infrastructure

- **Provider**: Supabase Realtime (PostgreSQL Replication).
- **Latency Target**: Messages must appear in <200ms.
- **Implementation Status**: Fully operational for both Chat and Notifications.
- **Network Resilience**: API calls routed via `127.0.0.1` locally to bypass standard Windows `localhost` DNS resolution latency/errors.

### 8.3 Accountability & Moderation

- **Audit Button**: Every message has a "Report" action for candidates to flag unprofessional behavior.
- **Shadow Review**: Reported threads are flagged in the administrative backend for manual review.
- **Safe Mode**: Recruiters cannot delete messages once sent; transparency is absolute for security audits.

- **Unbiased Scoring**: Recruiter answers are graded on a **0-6 scale** based on structural signals rather than sentiment.
- **Grading Dimensions**: Relevance, Specificity, Clarity, and Ownership.
- **Normalization**: The final **Company Profile Score (CPS)** is normalized to a 0-100% scale.

### 7.3 Competitive Progress Model (Multi-Recruiter Handling)

TalentFlow handles companies with multiple recruiters through an inheritance/competition logic:

- **Baseline Inheritance**: If "Recruiter A" has already earned a CPS for the company, "Recruiter B" can skip the assessment and inherit that score.
- **High-Score Progress**: If a recruiter chooses to take the assessment despite a score existing, the system performs a `MAX(old_score, new_score)` comparison. The company's public CPS only updates if the new recruiter achieves a better score.
- **Teammate Identification**: Recruiters belonging to the same organization are identified via the `company_id` foreign key in the `recruiter_profiles` table.

### 7.4 Feature Gating & "Do It Later"

- **Postponement**: Recruiters can skip the assessment during onboarding by choosing "Do It Later."
- **Locking Logic**: If the company has **zero CPS** (no recruiter has taken it), dashboard features like job posting and talent discovery remain locked.
- **Unlock**: Features unlock once _any_ recruiter from the company completes the assessment and generates a score > 0.

### 7.5 Security: The "Nuclear Ban"

- **Monitoring**: Tab switching and window activity are strictly monitored during the recruiter assessment.
- **Enforcement**: 2 violations result in immediate disqualification and a permanent block. The user is added to the `blocked_users` table and their account status is set to `Blocked`.

---

## 8. Infrastructure Overview

- **Primary Model**: Gemini 1.5 Flash (for speed and semantic grading).
- **Secondary Model**: Gemini 1.5 Pro (for complex skill-based Case Studies for Leadership roles).
- **Backend**: Async Python (FastAPI).
- **Database**: Supabase (PostgreSQL) with Row-Level Security (RLS).
- **Frontend**: Next.js 15 with React 19 (App Router).
